{
    "version": "https://jsonfeed.org/version/1",
    "title": "今天也请继续加油 • All posts by \"rsync\" tag",
    "description": "",
    "home_page_url": "http://wuhegucheng.github.io",
    "items": [
        {
            "id": "http://wuhegucheng.github.io/2023/04/01/linux/lnmp%E6%9E%B6%E6%9E%84/02.%20rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/01.%20rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/",
            "url": "http://wuhegucheng.github.io/2023/04/01/linux/lnmp%E6%9E%B6%E6%9E%84/02.%20rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/01.%20rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/",
            "title": "rsync数据备份",
            "date_published": "2023-04-01T08:46:15.000Z",
            "content_html": "<h1 id=\"rsync数据备份\"><a class=\"markdownIt-Anchor\" href=\"#rsync数据备份\">#</a> rsync 数据备份</h1>\n<h2 id=\"环境准备\"><a class=\"markdownIt-Anchor\" href=\"#环境准备\">#</a> 环境准备</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">主机名</th>\n<th style=\"text-align:center\">内网 IP</th>\n<th style=\"text-align:center\">外网 IP</th>\n<th style=\"text-align:center\">角色</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">web01</td>\n<td style=\"text-align:center\">172.16.1.7</td>\n<td style=\"text-align:center\">10.0.0.7</td>\n<td style=\"text-align:center\">备份客户端</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">backup</td>\n<td style=\"text-align:center\">172.16.1.41</td>\n<td style=\"text-align:center\">10.0.0.41</td>\n<td style=\"text-align:center\">备份服务端</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"rsync概述\"><a class=\"markdownIt-Anchor\" href=\"#rsync概述\">#</a> rsync 概述</h2>\n<p>rsync 是一款开源、快速、多功能、可实现<strong>全量及增量</strong>的本地或<strong>远程数据同步</strong>备份的优秀工具。rsync 软件适用于 Unix、linux、windows 等多种操作平台</p>\n<blockquote>\n<p><strong>为什么使用 rsync 不用 scp？</strong></p>\n<ul>\n<li>\n<p>scp 是基于 ssh 协议的命令，不是一个服务</p>\n</li>\n<li>\n<p>scp 每次都基于全量拷贝，rsync 支持增量拷贝</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"备份类型\"><a class=\"markdownIt-Anchor\" href=\"#备份类型\">#</a> 备份类型</h2>\n<ul>\n<li>\n<p>全量备份</p>\n<ul>\n<li>\n<p>将数据全部备份出来</p>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513223426274.png\" alt=\"image-20220513223426274\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>增量备份</p>\n<ul>\n<li>\n<p>基于上一次备份，新增部分的数据备份出来</p>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513223539309.png\" alt=\"image-20220513223539309\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>差异备份</p>\n<ul>\n<li>基于全量备份，新增部分的数据备份出来</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"rsync应用场景\"><a class=\"markdownIt-Anchor\" href=\"#rsync应用场景\">#</a> rsync 应用场景</h2>\n<ul>\n<li>推：所有主机推送本地数据至 rsync 备份服务器，会导致数据同步缓慢（适合少量数据备份）</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513225122692.png\" alt=\"image-20220513225122692\"></p>\n<ul>\n<li>拉：rsync 备份服务端拉去所有主机上的数据，会导致备份服务器开销过大</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/360%E6%88%AA%E5%9B%BE1814122193114116.png\" alt=\"360截图1814122193114116\"></p>\n<ul>\n<li>大量服务器备份场景</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513225426835.png\" alt=\"image-20220513225426835\"></p>\n<ul>\n<li>异地备份实现思路</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513225858773.png\" alt=\"image-20220513225858773\"></p>\n<h2 id=\"rsync传输模式\"><a class=\"markdownIt-Anchor\" href=\"#rsync传输模式\">#</a> rsync 传输模式</h2>\n<p><font color='red'><strong>注意：rsync 拷贝目录时，加 / 和不加 / 是有区别的</strong></font></p>\n<p>/etc/ ：将 etc 目录下的所有文件拷贝过去，不包括目录本身</p>\n<p>/etc ：将 etc 目录本身和目录下的所有文件一并拷贝过去</p>\n<ul>\n<li>本地模式（cp）</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Local: rsync [OPTION...] SRC... [DEST] </span><br><span class=\"line\">\t<span class=\"built_in\">cp</span> [OPTION]... SOURCE DEST </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">rsync [选项] 源文件.. 目标路径</span><br></pre></td></tr></table></figure>\n<ul>\n<li>远程模式（scp）</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Access via remote shell: </span><br><span class=\"line\">\tPull: 拉 rsync [OPTION...] [USER@]HOST:SRC... [DEST] </span><br><span class=\"line\">\tPush: 推 rsync [OPTION...] SRC... [USER@]HOST:DEST</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#语法</span></span><br><span class=\"line\">拉：rsync [选项] [用户@]主机IP:文件路径 本机目录 </span><br><span class=\"line\">推：rsync [选项] 本机文件 [用户@]主机IP:目录</span><br><span class=\"line\"></span><br><span class=\"line\">注意：如果不加 用户@ 默认以当前系统登录的用户为用户名</span><br></pre></td></tr></table></figure>\n<ul>\n<li>守护进程模式（把 rsync 当成服务启动）</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Access via rsync daemon: </span><br><span class=\"line\">\tPull: rsync [OPTION...] [USER@]HOST::SRC... [DEST] </span><br><span class=\"line\">\tPush: rsync [OPTION...] SRC... [USER@]HOST::DEST </span><br><span class=\"line\"></span><br><span class=\"line\">拉：rsync [选项..] [用户名@]主机IP::配置文件中的模块名 本机目录 </span><br><span class=\"line\">推：rsync [选项..] 本机文件 [用户名@]主机IP::配置文件中的模块名</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p><strong>企业中为啥使用守护进程模式？</strong></p>\n<ul>\n<li>\n<p>远程模式和 scp 差不多，基于 ssh 协议</p>\n</li>\n<li>\n<p>需要知道系统的用户名和密码</p>\n</li>\n<li>\n<p>守护进程不需要 ssh 协议，服务启动后，自带端口</p>\n</li>\n<li>\n<p>守护进程可以设置匿名用户，不需要使用系统用户</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"rsync选项\"><a class=\"markdownIt-Anchor\" href=\"#rsync选项\">#</a> rsync 选项</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-a：归档模式传输, 等于-tropgDl </span><br><span class=\"line\">-v：显示同步过程 </span><br><span class=\"line\">-z：压缩，提高传输效率 </span><br><span class=\"line\">============================== </span><br><span class=\"line\">-t：time 保持文件的时间信息 </span><br><span class=\"line\">-r：拷贝目录时，递归拷贝 </span><br><span class=\"line\">-o：owner 保持文件的属主信息 </span><br><span class=\"line\">-g：group 保持文件的属组信息 </span><br><span class=\"line\">-p：perm 保持文件的权限信息 </span><br><span class=\"line\">-D：device 保持设备文件的信息 </span><br><span class=\"line\">-l：<span class=\"built_in\">link</span> 保留软链接</span><br><span class=\"line\">==============================</span><br><span class=\"line\">-P：显示进度 </span><br><span class=\"line\">-L：保留软链接指向的目标文件 </span><br><span class=\"line\">--exclude=PATTERN 指定排除不需要传输的文件模式 </span><br><span class=\"line\">--exclude-from=file 指定排除文件 </span><br><span class=\"line\">--bwlimit=1 限速传输 </span><br><span class=\"line\">--partial 断点续传 </span><br><span class=\"line\">--delete 决定数据是否要同步 <span class=\"built_in\">rm</span> </span><br><span class=\"line\">--password-file= 指定密码文件</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "rsync"
            ]
        }
    ]
}