{
    "version": "https://jsonfeed.org/version/1",
    "title": "今天也请继续加油 • All posts by \"rsync\" tag",
    "description": "",
    "home_page_url": "http://wuhegucheng.github.io",
    "items": [
        {
            "id": "http://wuhegucheng.github.io/2023/04/02/linux/lnmp%20build/02.rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/01.%20rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/",
            "url": "http://wuhegucheng.github.io/2023/04/02/linux/lnmp%20build/02.rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/01.%20rsync%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/",
            "title": "rsync数据备份",
            "date_published": "2023-04-02T08:46:15.000Z",
            "content_html": "<h1 id=\"rsync数据备份\"><a class=\"markdownIt-Anchor\" href=\"#rsync数据备份\">#</a> rsync 数据备份</h1>\n<h2 id=\"环境准备\"><a class=\"markdownIt-Anchor\" href=\"#环境准备\">#</a> 环境准备</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">主机名</th>\n<th style=\"text-align:center\">内网 IP</th>\n<th style=\"text-align:center\">外网 IP</th>\n<th style=\"text-align:center\">角色</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">web01</td>\n<td style=\"text-align:center\">172.16.1.7</td>\n<td style=\"text-align:center\">10.0.0.7</td>\n<td style=\"text-align:center\">备份客户端</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">backup</td>\n<td style=\"text-align:center\">172.16.1.41</td>\n<td style=\"text-align:center\">10.0.0.41</td>\n<td style=\"text-align:center\">备份服务端</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"rsync概述\"><a class=\"markdownIt-Anchor\" href=\"#rsync概述\">#</a> rsync 概述</h2>\n<p>rsync 是一款开源、快速、多功能、可实现<strong>全量及增量</strong>的本地或<strong>远程数据同步</strong>备份的优秀工具。rsync 软件适用于 Unix、linux、windows 等多种操作平台</p>\n<blockquote>\n<p><strong>为什么使用 rsync 不用 scp？</strong></p>\n<ul>\n<li>\n<p>scp 是基于 ssh 协议的命令，不是一个服务</p>\n</li>\n<li>\n<p>scp 每次都基于全量拷贝，rsync 支持增量拷贝</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"备份类型\"><a class=\"markdownIt-Anchor\" href=\"#备份类型\">#</a> 备份类型</h2>\n<ul>\n<li>\n<p>全量备份</p>\n<ul>\n<li>\n<p>将数据全部备份出来</p>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513223426274.png\" alt=\"image-20220513223426274\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>增量备份</p>\n<ul>\n<li>\n<p>基于上一次备份，新增部分的数据备份出来</p>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513223539309.png\" alt=\"image-20220513223539309\"></p>\n</li>\n</ul>\n</li>\n<li>\n<p>差异备份</p>\n<ul>\n<li>基于全量备份，新增部分的数据备份出来</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"rsync应用场景\"><a class=\"markdownIt-Anchor\" href=\"#rsync应用场景\">#</a> rsync 应用场景</h2>\n<ul>\n<li>推：所有主机推送本地数据至 rsync 备份服务器，会导致数据同步缓慢（适合少量数据备份）</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513225122692.png\" alt=\"image-20220513225122692\"></p>\n<ul>\n<li>拉：rsync 备份服务端拉去所有主机上的数据，会导致备份服务器开销过大</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/360%E6%88%AA%E5%9B%BE1814122193114116.png\" alt=\"360截图1814122193114116\"></p>\n<ul>\n<li>大量服务器备份场景</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513225426835.png\" alt=\"image-20220513225426835\"></p>\n<ul>\n<li>异地备份实现思路</li>\n</ul>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220513225858773.png\" alt=\"image-20220513225858773\"></p>\n<h2 id=\"rsync传输模式\"><a class=\"markdownIt-Anchor\" href=\"#rsync传输模式\">#</a> rsync 传输模式</h2>\n<p><font color='red'><strong>注意：rsync 拷贝目录时，加 / 和不加 / 是有区别的</strong></font></p>\n<p>/etc/ ：将 etc 目录下的所有文件拷贝过去，不包括目录本身</p>\n<p>/etc ：将 etc 目录本身和目录下的所有文件一并拷贝过去</p>\n<ul>\n<li>本地模式（cp）</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Local: <span class=\"token function\">rsync</span> <span class=\"token punctuation\">[</span>OPTION<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> SRC<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span>DEST<span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token function\">cp</span> <span class=\"token punctuation\">[</span>OPTION<span class=\"token punctuation\">]</span><span class=\"token punctuation\">..</span>. SOURCE DEST </pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#语法</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">rsync</span> <span class=\"token punctuation\">[</span>选项<span class=\"token punctuation\">]</span> 源文件<span class=\"token punctuation\">..</span> 目标路径</pre></td></tr></table></figure><ul>\n<li>远程模式（scp）</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Access via remote shell: </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tPull: 拉 <span class=\"token function\">rsync</span> <span class=\"token punctuation\">[</span>OPTION<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token environment constant\">USER</span>@<span class=\"token punctuation\">]</span>HOST:SRC<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span>DEST<span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tPush: 推 <span class=\"token function\">rsync</span> <span class=\"token punctuation\">[</span>OPTION<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> SRC<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span><span class=\"token environment constant\">USER</span>@<span class=\"token punctuation\">]</span>HOST:DEST</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#语法</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>拉：rsync <span class=\"token punctuation\">[</span>选项<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>用户@<span class=\"token punctuation\">]</span>主机IP:文件路径 本机目录 </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>推：rsync <span class=\"token punctuation\">[</span>选项<span class=\"token punctuation\">]</span> 本机文件 <span class=\"token punctuation\">[</span>用户@<span class=\"token punctuation\">]</span>主机IP:目录</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>注意：如果不加 用户@ 默认以当前系统登录的用户为用户名</pre></td></tr></table></figure><ul>\n<li>守护进程模式（把 rsync 当成服务启动）</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Access via <span class=\"token function\">rsync</span> daemon: </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tPull: <span class=\"token function\">rsync</span> <span class=\"token punctuation\">[</span>OPTION<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span><span class=\"token environment constant\">USER</span>@<span class=\"token punctuation\">]</span>HOST::SRC<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span>DEST<span class=\"token punctuation\">]</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tPush: <span class=\"token function\">rsync</span> <span class=\"token punctuation\">[</span>OPTION<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> SRC<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span><span class=\"token environment constant\">USER</span>@<span class=\"token punctuation\">]</span>HOST::DEST </pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>拉：rsync <span class=\"token punctuation\">[</span>选项<span class=\"token punctuation\">..</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>用户名@<span class=\"token punctuation\">]</span>主机IP::配置文件中的模块名 本机目录 </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>推：rsync <span class=\"token punctuation\">[</span>选项<span class=\"token punctuation\">..</span><span class=\"token punctuation\">]</span> 本机文件 <span class=\"token punctuation\">[</span>用户名@<span class=\"token punctuation\">]</span>主机IP::配置文件中的模块名</pre></td></tr></table></figure><blockquote>\n<p><strong>企业中为啥使用守护进程模式？</strong></p>\n<ul>\n<li>\n<p>远程模式和 scp 差不多，基于 ssh 协议</p>\n</li>\n<li>\n<p>需要知道系统的用户名和密码</p>\n</li>\n<li>\n<p>守护进程不需要 ssh 协议，服务启动后，自带端口</p>\n</li>\n<li>\n<p>守护进程可以设置匿名用户，不需要使用系统用户</p>\n</li>\n</ul>\n</blockquote>\n<h2 id=\"rsync选项\"><a class=\"markdownIt-Anchor\" href=\"#rsync选项\">#</a> rsync 选项</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>-a：归档模式传输, 等于-tropgDl </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>-v：显示同步过程 </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-z：压缩，提高传输效率 </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-t：time 保持文件的时间信息 </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-r：拷贝目录时，递归拷贝 </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-o：owner 保持文件的属主信息 </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-g：group 保持文件的属组信息 </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>-p：perm 保持文件的权限信息 </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-D：device 保持设备文件的信息 </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>-l：link 保留软链接</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>-P：显示进度 </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-L：保留软链接指向的目标文件 </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>PATTERN 指定排除不需要传输的文件模式 </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>--exclude-from<span class=\"token operator\">=</span>file 指定排除文件 </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token parameter variable\">--bwlimit</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> 限速传输 </pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token parameter variable\">--partial</span> 断点续传 </pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token parameter variable\">--delete</span> 决定数据是否要同步 <span class=\"token function\">rm</span> </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>--password-file<span class=\"token operator\">=</span> 指定密码文件</pre></td></tr></table></figure>",
            "tags": [
                "rsync"
            ]
        }
    ]
}