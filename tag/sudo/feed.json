{
    "version": "https://jsonfeed.org/version/1",
    "title": "今天也请继续加油 • All posts by \"sudo\" tag",
    "description": "",
    "home_page_url": "http://wuhegucheng.github.io",
    "items": [
        {
            "id": "http://wuhegucheng.github.io/2023/04/01/linux/base/08.%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/04.%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%862/",
            "url": "http://wuhegucheng.github.io/2023/04/01/linux/base/08.%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/04.%E7%94%A8%E6%88%B7%E7%BB%84%E7%AE%A1%E7%90%862/",
            "title": "用户组管理2",
            "date_published": "2023-04-01T08:46:15.000Z",
            "content_html": "<h1 id=\"用户组管理\"><a class=\"markdownIt-Anchor\" href=\"#用户组管理\">#</a> 用户组管理</h1>\n<blockquote>\n<p>什么是 <code>sudo</code> ？</p>\n<ul>\n<li><code>sudo</code>  就是普通用户可以提权，执行 root 用户可以执行的命令</li>\n</ul>\n<p>为什么要用到 <code>sudo</code> ？</p>\n<ul>\n<li>如果在公司中，入职后，领导给运维的用户时普通用户，但是有些命令只能 root 执行</li>\n</ul>\n</blockquote>\n<h3 id=\"sudo如何使用\"><a class=\"markdownIt-Anchor\" href=\"#sudo如何使用\">#</a>  <code>sudo</code>  如何使用</h3>\n<ul>\n<li>\n<p>1. 系统的超级管理员（root）需要做 <code>sudo</code>  的配置（发一个兵符给指定的普通用户）</p>\n</li>\n<li>\n<p>2. 普通用户只需要在，执行的命令之前，加上 <code>sudo</code>  即可</p>\n</li>\n</ul>\n<p>配置文件 <code>/etc/sudoers</code></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">99</span> <span class=\"token comment\">## Allow root to run any commands anywhere </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">100</span> root\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tALL</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1</span>.用户名</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2</span>.主机名</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">3</span>.角色名</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">4</span>.命令名</pre></td></tr></table></figure><h3 id=\"编辑权限visudo\"><a class=\"markdownIt-Anchor\" href=\"#编辑权限visudo\">#</a> 编辑权限 <code>visudo</code></h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">选项</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">-c</td>\n<td style=\"text-align:center\">检查语法</td>\n</tr>\n</tbody>\n</table>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#python 用户提权</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>python\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tALL</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sudo passwd roger1</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>sudo<span class=\"token punctuation\">]</span> password <span class=\"token keyword\">for</span> python:</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#普通用户无需输入密码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>python\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tNOPASSWD:ALL</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#主机别名</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Host_Alias    FILESERVERS <span class=\"token operator\">=</span> fs1, fs2</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>python\t<span class=\"token assign-left variable\">FILESERVERS</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tNOPASSWD:ALL</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#角色别名</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Cmnd_Alias SOFTWARE <span class=\"token operator\">=</span> /bin/rpm, /usr/bin/up2date, /usr/bin/yum</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>python\t<span class=\"token assign-left variable\">FILESERVERS</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tNOPASSWD:Cmnd_Alias SOFTWARE</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Cmnd_Alias SOFTWARE <span class=\"token operator\">=</span> ！/bin/rpm, <span class=\"token operator\">!</span>/usr/bin/up2date</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>python\t<span class=\"token assign-left variable\">FILESERVERS</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tNOPASSWD:Cmnd_Alias SOFTWARE</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#用户组提权</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>%wheel\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tALL</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>%wheel\t<span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>\tNOPASSWD:ALL</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#主要用 usermod 给用户提权，把用户加到有权限的组里</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token function\">usermod</span> 用户名 <span class=\"token parameter variable\">-G</span> 提权组</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#报错 </span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sudo ll </span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>sudo: ll: <span class=\"token builtin class-name\">command</span> not found </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>原因：ll是别名，不是系统命令，sudo不走别名，只认识系统命令</pre></td></tr></table></figure><h3 id=\"vardbsudo\"><a class=\"markdownIt-Anchor\" href=\"#vardbsudo\">#</a> /var/db/sudo</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#密码过期文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/var/db/sudo/lectured</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>通过Atime检验是否过期</pre></td></tr></table></figure><h3 id=\"sudo执行流程\"><a class=\"markdownIt-Anchor\" href=\"#sudo执行流程\">#</a>  <code>sudo</code>  执行流程</h3>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/15613875305374.jpg\" alt=\"15613875305374\"></p>\n<h4 id=\"总结\"><a class=\"markdownIt-Anchor\" href=\"#总结\">#</a> 总结</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1</span>.会修改visudo，添加用户提权 </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2</span>.给用户免密执行sudo的权限 </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">3</span>.自定义用户的可执行命令，和不可执行命令 </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">4</span>.给组分配提权的权限 </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">5</span>.提权不用修改visudo，只需要加入wheel组，即可</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>注意：除非企业中有要求，哪些命令需要用，哪些不能使用</pre></td></tr></table></figure>",
            "tags": [
                "用户组",
                "sudo"
            ]
        }
    ]
}