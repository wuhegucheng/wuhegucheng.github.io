{
    "version": "https://jsonfeed.org/version/1",
    "title": "今天也请继续加油 • All posts by \"01.环境准备\" category",
    "description": "",
    "home_page_url": "http://wuhegucheng.github.io",
    "items": [
        {
            "id": "http://wuhegucheng.github.io/2023/04/01/linux/lnmp%20build/01.%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/01.%20%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/",
            "url": "http://wuhegucheng.github.io/2023/04/01/linux/lnmp%20build/01.%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87/01.%20%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D/",
            "title": "111",
            "date_published": "2023-04-01T08:46:15.000Z",
            "content_html": "<h1 id=\"架构介绍\"><a class=\"markdownIt-Anchor\" href=\"#架构介绍\">#</a> 架构介绍</h1>\n<h2 id=\"架构相关名词\"><a class=\"markdownIt-Anchor\" href=\"#架构相关名词\">#</a> 架构相关名词</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">项目：独立的一个网站，或者独立的一个app应用 </span><br><span class=\"line\">架构：用来维护或者运行一个项目的一组服务器 </span><br><span class=\"line\">集群：为解决某个特定问题将多台计算机组合起来形成的单个系统（避免单点故障）</span><br><span class=\"line\">高可用：当一台服务器不可用，另一台服务器自动接管，保证业务不down机 </span><br><span class=\"line\">负载均衡：将用户的请求，分摊到多个操作单元上执行,为了解决服务器压力不均衡的问题</span><br></pre></td></tr></table></figure>\n<h2 id=\"架构演变\"><a class=\"markdownIt-Anchor\" href=\"#架构演变\">#</a> 架构演变</h2>\n<p><img data-src=\"https://roger-hub.oss-cn-shanghai.aliyuncs.com/img_devops/image-20220512193446428.png\" alt=\"image-20220512193446428\"></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#用户请求，针对用户设计的架构 </span></span><br><span class=\"line\">在浏览器中输入：https://blog.driverzeng.com </span><br><span class=\"line\">1.DNS域名解析服务器 ==》将blog.driverzeng.com解析成IP地址：114.80.187.8 </span><br><span class=\"line\">2.浏览器和该IP地址（114.80.187.8）的服务器(https:// 443)端（http:// 80）口建立连接 </span><br><span class=\"line\">3.请求要经过114.80.187.8服务器的防火墙，如果允许你的IP（101.229.206.48）访问服务器的443端口 </span><br><span class=\"line\">\t- 防火墙：过滤用户请求，防止恶意请求，针对IP和端口进行限制 </span><br><span class=\"line\">\t- 关闭防火墙，关闭Selinux </span><br><span class=\"line\">\t- CentOS6之前：iptables </span><br><span class=\"line\">\t- CentOS7开始：firewalld，也可以使用iptables </span><br><span class=\"line\">\t- 硬件防火墙 </span><br><span class=\"line\">4.请求通过防火墙后，访问到负载均衡服务器 </span><br><span class=\"line\">\t- Nginx </span><br><span class=\"line\">\t- HAproxy </span><br><span class=\"line\">\t- LVS </span><br><span class=\"line\">\t- F5（硬件） </span><br><span class=\"line\">5.请求通过负载均衡后会被下发到后面的web服务器 </span><br><span class=\"line\">\t- Nginx </span><br><span class=\"line\">\t- Apache </span><br><span class=\"line\">\t- Tomcat（Java） </span><br><span class=\"line\">\t- PHP（PHP代码容器） </span><br><span class=\"line\">6.前端代码会请求后端的代码，后端代码请求数据库 </span><br><span class=\"line\">\t- MySQL </span><br><span class=\"line\">\t- Oracle </span><br><span class=\"line\">\t- SQLServer </span><br><span class=\"line\">\t- MariaDB </span><br><span class=\"line\">7.数据库之前会有缓存服务器，如果缓存中有请求的数据，则直接通过缓存返回给用户 </span><br><span class=\"line\">\t- Redis </span><br><span class=\"line\">\t- MangoDB </span><br><span class=\"line\">\t- Memcache </span><br><span class=\"line\">8.文件服务器（共享存储服务器）专门用来存储图片，视频，二进制类型的数据 </span><br><span class=\"line\">\t- NFS </span><br><span class=\"line\">\t- GFS </span><br><span class=\"line\">\t- FastDFS </span><br><span class=\"line\">\t- ceph</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#运维自动化工具 </span></span><br><span class=\"line\">所有服务器，至少要有两块网卡（有两个IP地址） </span><br><span class=\"line\">外网IP地址：针对用户访问，给用户提供服务 </span><br><span class=\"line\">内网IP地址：服务器之间互相可以访问 </span><br><span class=\"line\">跳板机，VPN：访问内网服务器 </span><br><span class=\"line\">\t- openvpn </span><br><span class=\"line\">\t- pptpvpn </span><br><span class=\"line\">\t- jumpserver </span><br><span class=\"line\">监控：检测服务器上的应用状态，硬件状态，网络状态，系统状态，业务状态 </span><br><span class=\"line\">\t- zabbix </span><br><span class=\"line\">\t- nagios </span><br><span class=\"line\">\t- open-falcon </span><br><span class=\"line\">\t- promethues </span><br><span class=\"line\">\t- cacti</span><br><span class=\"line\">数据备份服务器：用来备份所有重要数据 </span><br><span class=\"line\">\t- rsync 批量管理服务器 </span><br><span class=\"line\">\t- ansible </span><br><span class=\"line\">\t- saltstack </span><br><span class=\"line\">日志服务器 </span><br><span class=\"line\">\t- ELK </span><br><span class=\"line\">\t- flume </span><br><span class=\"line\">代码发布服务器 </span><br><span class=\"line\">\t- Jenkins </span><br><span class=\"line\">代码存储服务器 </span><br><span class=\"line\">\t- Gitlab</span><br></pre></td></tr></table></figure>\n<h2 id=\"架构模板机准备\"><a class=\"markdownIt-Anchor\" href=\"#架构模板机准备\">#</a> 架构模板机准备</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#编辑网卡名</span></span><br><span class=\"line\">win按Tab键/Mac按e键</span><br><span class=\"line\">quiet net.ifnames=0 biosdevname=0</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#配置网卡</span></span><br><span class=\"line\"><span class=\"comment\">##编辑第一块网卡 </span></span><br><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-eth0 </span><br><span class=\"line\">删除UUID  <span class=\"comment\">#mac地址</span></span><br><span class=\"line\">BOOTPROTO=dhcp =&gt; BOOTPROTO=static 或者 BOOTPROTO=none </span><br><span class=\"line\">ONBOOT=no =&gt; ONBOOT=<span class=\"built_in\">yes</span> </span><br><span class=\"line\">IPADDR=10.0.0.100 </span><br><span class=\"line\">NETMASK=255.255.255.0 </span><br><span class=\"line\">GATEWAY=10.0.0.2 </span><br><span class=\"line\">DNS1=223.5.5.5 </span><br><span class=\"line\"><span class=\"comment\">##编辑第二块网卡 </span></span><br><span class=\"line\">vi /etc/sysconfig/network-scripts/ifcfg-eth1 </span><br><span class=\"line\">删除UUID </span><br><span class=\"line\">BOOTPROTO=dhcp =&gt; BOOTPROTO=static 或者 BOOTPROTO=none </span><br><span class=\"line\">ONBOOT=no =&gt; ONBOOT=<span class=\"built_in\">yes</span> </span><br><span class=\"line\">IPADDR=172.16.1.100 0</span><br><span class=\"line\">NETMASK=255.255.255.0 </span><br><span class=\"line\"><span class=\"comment\">##重启网卡 </span></span><br><span class=\"line\">systemctl restart network</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#系统优化</span></span><br><span class=\"line\"><span class=\"comment\">#1.更改yum源 </span></span><br><span class=\"line\"><span class=\"comment\">##删除所有系统内置yum源</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># gzip /etc/yum.repos.d/*.repo</span></span><br><span class=\"line\">或</span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># rm -fr /etc/yum.repos.d/* </span></span><br><span class=\"line\"><span class=\"comment\">##Base源 </span></span><br><span class=\"line\">curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo </span><br><span class=\"line\"><span class=\"comment\">##Epel源 </span></span><br><span class=\"line\">curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class=\"line\"><span class=\"comment\">##优化阿里云的源（删除多余的baseurl） </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vi /etc/yum.repos.d/CentOS-Base.repo</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#安装基础命令和环境 </span></span><br><span class=\"line\">yum install net-tools vim tree htop iftop gcc gcc-c++ glibc iotop lrzsz sl wget unzip telnet nmap nc psmisc dos2unix bash-completion bash-completion-extra sysstat httpd-tools -y</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#关闭防火墙 </span></span><br><span class=\"line\"><span class=\"comment\">##关闭防火墙服务 </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># systemctl stop firewalld </span></span><br><span class=\"line\"><span class=\"comment\">##取消防火墙开机自启 </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># systemctl disable firewalld</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#关闭selinux </span></span><br><span class=\"line\"><span class=\"comment\">##查看selinux </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># getenforce </span></span><br><span class=\"line\">Enforcing </span><br><span class=\"line\"><span class=\"comment\">##开启状态 </span></span><br><span class=\"line\"><span class=\"comment\">##临时关闭 </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># setenforce 0 </span></span><br><span class=\"line\"><span class=\"comment\">##永久关闭 </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># vim /etc/sysconfig/selinux SELINUX=enfocing =&gt; SELINUX=disabled</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#优化文件描述符 </span></span><br><span class=\"line\"><span class=\"comment\">##查看文件描述 </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ulimit -n 65535 </span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># ulimit -a </span></span><br><span class=\"line\"><span class=\"comment\">##设置文件描述符为65535 </span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;* - nofile 65535&#x27;</span> &gt;&gt; /etc/security/limits.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#修改主机脚本</span></span><br><span class=\"line\"><span class=\"comment\">#!/bin/bash</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;Please input HOSTNAME：&quot;</span> h</span><br><span class=\"line\"><span class=\"built_in\">read</span> -p <span class=\"string\">&quot;Please input IP：&quot;</span> IP</span><br><span class=\"line\"></span><br><span class=\"line\">hostnamectl set-hostname <span class=\"variable\">$h</span></span><br><span class=\"line\">sed -i <span class=\"string\">&quot;s#100#<span class=\"variable\">$IP</span>#g&quot;</span> /etc/sysconfig/network-scripts/ifcfg-eth&#123;0,1&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"机器准备\"><a class=\"markdownIt-Anchor\" href=\"#机器准备\">#</a> 机器准备</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">外网 IP</th>\n<th style=\"text-align:center\">内网 IP</th>\n<th style=\"text-align:center\">主机名</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">10.0.0.5</td>\n<td style=\"text-align:center\">172.16.1.5</td>\n<td style=\"text-align:center\">lb01</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.6</td>\n<td style=\"text-align:center\">172.16.1.6</td>\n<td style=\"text-align:center\">lb02</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.7</td>\n<td style=\"text-align:center\">172.16.1.7</td>\n<td style=\"text-align:center\">web01</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.8</td>\n<td style=\"text-align:center\">172.16.1.8</td>\n<td style=\"text-align:center\">web02</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.9</td>\n<td style=\"text-align:center\">172.16.1.9</td>\n<td style=\"text-align:center\">web03</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.31</td>\n<td style=\"text-align:center\">172.16.1.31</td>\n<td style=\"text-align:center\">nfs</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.41</td>\n<td style=\"text-align:center\">172.16.1.41</td>\n<td style=\"text-align:center\">backup</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.51</td>\n<td style=\"text-align:center\">172.16.1.51</td>\n<td style=\"text-align:center\">db01</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.61</td>\n<td style=\"text-align:center\">172.16.1.61</td>\n<td style=\"text-align:center\">m01</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">10.0.0.71</td>\n<td style=\"text-align:center\">172.16.1.71</td>\n<td style=\"text-align:center\">zabbix</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": []
        }
    ]
}